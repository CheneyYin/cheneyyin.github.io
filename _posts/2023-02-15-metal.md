---
layout: post
title: "Metal"
subtitle: "介绍自研项目Metal的设计思路和效果"
date: 2023-02-15
author: "Cheney.Yin"
header-img: "img/bg-material.jpg"
project: true
tags:
 - Spark
 - Dataflow
 - 可视化
 - ETL
 - Metal
---

# What is Metal?

Metal是一款数据流建模软件，通过Metal可以管理数据流处理算子、可视化建模、批处理任务执行。


# What Metal can do for me?

如果你经常使用Spark SQL开发ETL Pipeline，积累了大量的DTD(Dataframe To Dataframe)的算子/操作，你可以按照Metal的插件规范改造你的算子/操作，使用Metal来管理这些插件。

如果你使用Metal，你可以很方便地复用这些插件。Metal提供了两种方式来构建数据流，数据流是由插件组合而成的。

- 第一种构建方式是Cli风格，你需要编写spec文件来配置数据流的结构以及数据处理算子的参数。
- 第二方式是可视化风格，Metal提供了用于数据流设计的Web UI即metal-ui。metal-ui是一个简易的数据流集成开发环境，相比于Cli风格，metal-ui降低了配置数据流的难度。metal-ui以Project的概念管理每个数据流。你可以在metal-ui中，创建Project、配置Project、绘制数据流、跟踪数据处理任务、管理算子插件等。

# Features

# Architecture

Metal项目目前包括如下几个组件，

```shell
.
├── metal-backend
├── metal-backend-api
├── metal-core
├── metal-maven-plugin
├── metal-on-spark
├── metal-on-spark-extensions
├── metal-parent
├── metal-server
├── metal-test
└── metal-ui
```

各个组件概况如下：

## metal-core

`metal-core`是Metal的核心，它定义了Metal数据流处理算子类型、数据流分析检查以及执行。

### 数据流处理算子

Metal数据流处理算子包括四种，分别为Source、Mapper、Fusion和Sink。

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="/img/resources/metal-plugin-class.svg" width = "95%" alt=""/>
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">
      数据流算子类型
  	</div>
</center>

从上图可以看出，所有算子/操作的最终父类为`Metal`，所有继承`Metal`的子类都有`id`、`name`以及配置属性`props`。其中，`props`用于为算子注入配置。`metal-core`下的Metal抽象算子是平台无关的。目前，Metal仅支持将Spark作为后端执行引擎。
上图中`MSource`、`MMapper`、`MFusion`和`MSink`定义了数据流的四种基本处理逻辑。
- `MSource`: 用于获取数据，没有数据输入，有输出。例如`JsonFileSource`是`MSource`在Spark上的一种实现。`JsonFileSource`用从文件中加载JSON格式的数据，返回一个带有模式的DataFrame。
- `MMapper`：用于处理数据，拥有一个输入，并且有输出。例如`SqlMMapper`是`MMapper`在Spark上的一种实现，能够让用户把输入的DataFrame作为一张表，编写SQL处理输入的DataFrame处理得到新的DataFrame。
- `MFusion`：和`MMapper`类似都是用于处理数据，但是`MFusion`必须有两个及以上的输入。例如`SqlMFusion`，它的功能和`SqlMMapper`类似，但是必须输入两张及以上的DataFrame。
- `MSink`：用于下沉数据（写入文件、消息队列等），拥有一个输入，没有输出。例如`ConsoleMSink`是`MSink`在Spark上一种实现，能够把输入的DataFrame输出在控制台上，常用于调试。

# Open Source Plan

